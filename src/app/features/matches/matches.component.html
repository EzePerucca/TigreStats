<div class="matches">
  <app-page-header
  title="Historial de Partidos"
  actionLabel="Filtrar por torneo" />

  @if (loading()) {
    <div class="ui-state ui-state--loading">Cargando partidos...</div>
  }

  @if (error()) {
    <div class="ui-state ui-state--error">⚠️ {{ error() }}</div>
  }

  @if (!loading() && !error()) {
    <section class="section">
      <div class="cards">
        <!-- Card 1: Total Jugados -->
        <div class="card card-total" (click)="setKpiFilter('played')">
          <div class="glow"></div>
          <div class="card-label">Total Jugados</div>
          <div class="card-number">{{ stats().played }}</div>
          <app-distribution-bar
            #distBar
            [played]="stats().played"
            [won]="stats().won"
            [drawn]="stats().drawn"
            [lost]="stats().lost">
          </app-distribution-bar>
        </div>
    
        <!-- Card 2: Ganados -->
        <div class="card card-result card-won" (click)="setKpiFilter('won')"
          [class.card-won--active]="selectedKpiFilter() === 'won'">
          <div class="badge badge-won">Victorias</div>
          <div class="card-label">Total Ganados</div>
          <div class="card-number">{{ stats().won }}</div>
          <div class="pct-wrap">
            <div class="pct-number">
              {{ distBar.ganadosPct() }}%<small> del total</small>
            </div>
          </div>
        </div>
    
        <!-- Card 3: Empatados -->
        <div class="card card-result card-draw" (click)="setKpiFilter('drawn')"
          [class.card-draw--active]="selectedKpiFilter() === 'drawn'">
          <div class="badge badge-draw">Empates</div>
          <div class="card-label">Total Empatados</div>
          <div class="card-number">{{ stats().drawn }}</div>
          <div class="pct-wrap">
            <div class="pct-number">
              {{ distBar.empatadosPct() }}%<small> del total</small>
            </div>
          </div>
        </div>
    
        <!-- Card 4: Perdidos -->
        <div class="card card-result card-lost" (click)="setKpiFilter('lost')"
          [class.card-lost--active]="selectedKpiFilter() === 'lost'">
          <div class="badge badge-lost">Derrotas</div>
          <div class="card-label">Total Perdidos</div>
          <div class="card-number">{{ stats().lost }}</div>
          <div class="pct-wrap">
            <div class="pct-number">
              {{ distBar.perdidosPct() }}%<small> del total</small>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="section matches-history">
      <div class="section__header">
        <h2 class="section__title">Historial Completo</h2>
      </div>
      <div class="matches-history__card">
        @if (filteredMatches().length) {
          <div class="matches-history__table-wrap">
            <table class="matches-history__table">
              <thead>
                <tr>
                  <th>Resultado</th>
                  <th>Partido</th>
                  <th>Marcador</th>
                  <th>Fecha</th>
                  <th>Torneo</th>
                  <th>Ronda</th>
                  <th>Condición</th>
                </tr>
              </thead>
              <tbody>
                @for (match of filteredMatches(); track trackById($index, match)) {
                  <tr>
                    <td>
                      <span class="result-badge" [class]="getResultClass(match.result)">
                        {{ getResultLabel(match.result) }}
                      </span>
                    </td>
                    <td class="matches-history__fixture">
                      <span [class.matches-history__team--tigre]="match.homeTeam === 'Tigre'">{{ match.homeTeam }}</span>
                      <span>vs</span>
                      <span [class.matches-history__team--tigre]="match.awayTeam === 'Tigre'">{{ match.awayTeam }}</span>
                    </td>
                    <td class="matches-history__score">{{ getScore(match) }}</td>
                    <td>{{ match.date | date: 'dd MMM yyyy' : '' : 'es' }}</td>
                    <td>{{ match.tournament }}</td>
                    <td>{{ match.round }}</td>
                    <td>{{ isHome(match) ? 'Local' : 'Visitante' }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <p class="ui-state ui-state--empty ui-state--card">No hay partidos para el filtro seleccionado.</p>
        }
      </div>
    </section>
  }
</div>
